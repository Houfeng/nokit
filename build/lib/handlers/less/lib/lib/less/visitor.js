/*csd*/(function(e){var c={visitDeeper:true},a=false;function b(f){return f;}function d(h,i){var g,f;for(g in h){if(h.hasOwnProperty(g)){f=h[g];switch(typeof f){case"function":if(f.prototype&&f.prototype.type){f.prototype.typeIndex=i++;}break;case"object":i=d(f,i);break;}}}return i;}e.visitor=function(f){this._implementation=f;this._visitFnCache=[];if(!a){d(e,1);a=true;}};e.visitor.prototype={visit:function(l){if(!l){return l;}var m=l.typeIndex;if(!m){return l;}var p=this._visitFnCache,j=this._implementation,f=m<<1,n=f|1,h=p[f],i=p[n],o=c,g;o.visitDeeper=true;if(!h){g="visit"+l.type;h=j[g]||b;i=j[g+"Out"]||b;p[f]=h;p[n]=i;}if(h!==b){var k=h.call(j,l,o);if(j.isReplacing){l=k;}}if(o.visitDeeper&&l&&l.accept){l.accept(this);}if(i!=b){i.call(j,l);}return l;},visitArray:function(j,k){if(!j){return j;}var f=j.length,h;if(k||!this._implementation.isReplacing){for(h=0;h<f;h++){this.visit(j[h]);}return j;}var l=[];for(h=0;h<f;h++){var g=this.visit(j[h]);if(!g.splice){l.push(g);}else{if(g.length){this.flatten(g,l);}}}return l;},flatten:function(f,o){if(!o){o=[];}var g,h,k,m,l,n;for(h=0,g=f.length;h<g;h++){k=f[h];if(!k.splice){o.push(k);continue;}for(l=0,m=k.length;l<m;l++){n=k[l];if(!n.splice){o.push(n);}else{if(n.length){this.flatten(n,o);}}}}return o;}};})(require("./tree"));