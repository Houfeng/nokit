/*csd*/var fs=require("fs");var path=require("path");var Handler=module.exports=function(b){var a=this;a.server=b;a.configs=a.server.configs;};Handler.prototype.handleRequest=function(b,c){var d=this;try{d.handleFileSystem(b,c);}catch(a){d.server.responseError(b,c,a.message);}};Handler.prototype.handleFileSystem=function(a,b){var c=this;fs.exists(a.physicalPath,function(d){if(d){fs.stat(a.physicalPath,function(f,g){if(g.isDirectory()){var e=c.findDefaultFile(a.physicalPath);if(e){a.physicalPath=e;a.mime=c.configs.mimeType[".html"];c.writeFile(a,b);}else{c.writeFolder(a,b);}}else{c.writeFile(a,b);}});}else{c.server.responseNotFound(a,b);}});};Handler.prototype.findDefaultFile=function(a){var b=this;var c=b.server.require("./core/utils");return c.each(b.server.configs.defaults,function(f,e){var d=path.resolve(a,e);if(fs.existsSync(d)){return d;}});};Handler.prototype.writeFolder=function(a,b){var c=this;fs.readdir(a.physicalPath,function(d,e){var f=[];e.forEach(function(h){var i=path.normalize(a.physicalPath+"/"+h);var j=fs.statSync(i);f.push({name:h,type:j.isDirectory()?"folder":"file"});});var g={server:c,request:a,items:f};c.server.responseContent(a,b,c.server.responsePages["dir"](g),c.configs.mimeType[".html"]);});};Handler.prototype.writeFile=function(a,b){var c=this;fs.readFile(a.physicalPath,function(e,d){if(e){c.server.responseError(a,b,e);}else{c.server.responseContent(a,b,d);}});};