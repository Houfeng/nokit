/*csd*/var http=require("http");var fs=require("fs");var path=require("path");var Server=function(a,b){var d=this;d.root=a||"";d.port=b||8000;var c=d.root[d.root.length-1];if(c==="/"||c==="\\"){d.root=d.root.substr(0,d.length-1);}d.init();};var mimes=Server.mimes={".html":"text/html",".htm":"text/html",".css":"text/css",".js":"text/javascript",".json":"application/x-javascript",".png":"image/png",".jpg":"image/jpg",".jpeg":"image/jpeg",".gif":"image/gif",".bmp":"image/bmp",".ico":"image/x-icon","*":"application/octet-stream"};var status=Server.status={"error":{code:500,message:"{0}<hr/>server error"},"success":{code:200},"notfound":{code:404,message:"{0}<hr/>not found"}};Server.prototype.error=function(b,c,a){var d=this;c.writeHead(status.error.code,{"Content-Type":mimes[".html"],"url":b.url});c.end(status.error.message.replace("{0}",a.message));};Server.prototype.notFound=function(a,b){var c=this;b.writeHead(status.notfound.code,{"Content-Type":mimes[".html"],"url":a.url});b.end(status.notfound.message.replace("{0}",a.physicalPath));};var getMime=Server.getMime=function(b){var a=path.extname(b);return mimes[a]||mimes["*"];};Server.prototype.writeFolder=function(a,b){var c=this;fs.readdir(a.physicalPath,function(e,f){var d=[];f.forEach(function(g){var h=path.normalize(a.physicalPath+"/"+g);var i=fs.statSync(h);if(i.isDirectory()){d.push('<li><a href="'+g+'/">'+g+"/</a></li>");}else{d.push('<li><a href="'+g+'">'+g+"</a></li>");}});b.writeHead(status.success.code,{"Content-Type":mimes[".html"],"url":a.url});b.end(a.url+"<hr/><ul>"+d.join("")+"</ul>");});};Server.prototype.writeFile=function(a,b){var c=this;fs.readFile(a.physicalPath,function(e,d){var f=getMime(a.physicalPath);b.writeHead(status.success.code,{"Content-Type":f,"url":a.url});b.end(d);});};Server.prototype.init=function(){var a=this;a.server=http.createServer(function(c,d){c.url=path.normalize(c.url||"");c.physicalPath=path.normalize(a.root+"/"+c.url.split("?")[0]);try{fs.exists(c.physicalPath,function(e){if(e){fs.stat(c.physicalPath,function(f,g){if(g.isDirectory()){a.writeFolder(c,d);}else{a.writeFile(c,d);}});}else{a.notFound(c,d);}});}catch(b){a.error(c,d,b);}});};Server.prototype.start=function(b,a){var c=this;c.port=b||c.port;c.server.listen(c.port,a);console.log("Server Start.");};Server.prototype.stop=function(a){var b=this;b.server.close(a);console.log("Server Stop.");};module.exports=Server;