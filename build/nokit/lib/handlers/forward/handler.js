/*csd*/var Handler=module.exports=function(b){var a=this;a.server=b;a.configs=a.server.configs;};Handler.prototype.handleRequest=function(a,b){var c=this;c.server.responseContent(a,b,a.url);};Handler.prototype.parseFwdUrl=function(b){var c={};c.protocol=b.indexOf("https://")-1?"https://":"http://";b=b.replace("https://","").replace("http://","");var a=b.indexOf("/");if(a>-1){c.hostAndPort=b.substring(0,a);c.host=c.hostAndPort.split(":")[0]||"";c.port=c.hostAndPort.split(":")[1]||80;c.path=b.substring(a);}else{c.hostAndPort=b;c.host=c.hostAndPort.split(":")[0]||"";c.port=c.hostAndPort.split(":")[1]||80;c.path="/";}return c;};Handler.prototype.forward=function(d,e,a){var f=this;d.headers.host=a.hostAndPort;d.headers.origin=a.protocol+a.hostAndPort;d.headers.referer=a.protocol+a.hostAndPort+a.path;var b=querystring.stringify(d.postData);d.headers["content-length"]=b.length;var c=http.request({host:a.host,port:a.port,path:a.path,method:d.method,headers:d.headers},function(g){e.writeHead(status.success.code,g.headers);g.on("data",function(h){e.write(h);}).on("end",function(){e.end();});}).on("error",function(g){Handler.prototype.error(d,e,"Remote Error : "+g.message);});c.write(b+"\n");c.end();};Handler.prototype.forwardUrl=function(d,e,f){var g=this;var c=f.value;var a=Handler.prototype.parseFwdUrl(c);var b=d.url.split("?")[1]||"";if(b.length>0){a.path+=(a.path.indexOf("?")>-1?"&":"?")+b;}Handler.prototype.forward(d,e,a);};Handler.prototype.forwardHost=function(c,d,e){var f=this;var b=e.value;var a=Handler.prototype.parseFwdUrl(b);a.path=c.url;Handler.prototype.forward(c,d,a);};Handler.prototype.getFwdExp=function(e,b){var d=null;for(var c in b){var a=new RegExp(c);if(a.test(e)){d={"key":c,"value":b[c]};break;}}return d;};Handler.prototype.handleForward=function(b,c){var d=this;var e=d.getFwdExp(b.withoutQueryStringURL,d.configs.fwd_url);var a=d.getFwdExp(b.withoutQueryStringURL,d.configs.fwd_host);if(e){d.forwardUrl(b,c,e);}else{if(a){d.forwardHost(b,c,a);}else{d.handleFileSystem(b,c);}}};