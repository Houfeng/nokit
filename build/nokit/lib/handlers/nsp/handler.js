/*csd*/var fs=require("fs");var path=require("path");var Handler=module.exports=function(b){var a=this;a.server=b;a.configs=a.server.configs;a.utils=a.server.require("./core/utils");a.tp=a.server.require("./core/tp");};Handler.prototype.handleRequest=function(b){var d=this;if(b.request.physicalPathExists){var c=d.compilePage(b,b.request.physicalPath);if(c==null){return;}var a=d.execPage(b,c);if(a==null){return;}b.responseContent(a);}else{b.responseNotFound();}};Handler.prototype.compilePage=function(c,a){var f=this;try{var b=fs.readFileSync(a);var e=f.tp.compile(b.toString(),{extend:f.createExtendObject(c)});return e;}catch(d){c.responseError(d.message);}return null;};Handler.prototype.resolvePath=function(b,a){var c=this;return path.resolve(path.dirname(b.request.physicalPath),a);};Handler.prototype.createExtendObject=function(a){var c=this;var b={"require":function(e){var d=this;try{return require(e);}catch(f){try{var g=c.resolvePath(a,e);return require(g);}catch(f){a.responseError('在 $.require 时 " '+e+' " 没有找到');}}},"include":function(e){var d=this;var h=c.resolvePath(a,e);var g=c.compilePage(a,h);var f=c.execPage(a,g);d(f);}};c.utils.copy(c.utils,b);return b;};Handler.prototype.execPage=function(a,d){var e=this;var c={server:e.server,handler:e,context:a,request:a.request,response:a.response};try{return d(c);}catch(b){a.responseError(b.message);}return null;};